<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">

<style>
body { font-family: 'Kanit', sans-serif; }
.fade-in { animation: fade .35s ease; }
@keyframes fade {
  from { opacity: 0; transform: scale(.96); }
  to { opacity: 1; transform: scale(1); }
}
</style>
</head>

<body class="bg-[#FBFBFD] flex items-center justify-center min-h-screen">

<!-- LOGIN -->
<div id="loginSection" class="bg-white p-8 rounded-3xl shadow-xl w-full max-w-md text-center fade-in">
  <h2 class="text-2xl font-bold mb-6">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>

  <button id="googleBtn" class="w-full border py-3 rounded-xl mb-3 flex justify-center gap-2">
    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-5">
    Google
  </button>

  <button id="phoneBtn" class="w-full bg-pink-500 text-white py-3 rounded-xl font-bold">
    üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ + OTP
  </button>
</div>

<!-- PHONE MODAL -->
<div id="phoneModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
<div class="bg-white p-6 rounded-2xl w-full max-w-sm text-center fade-in">

<!-- STEP 1 -->
<div id="step1">
  <h3 class="font-bold mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå</h3>
  <input id="phoneInput" type="tel" placeholder="08xxxxxxxx" maxlength="10"
    class="w-full p-3 border rounded-xl mb-3 text-center">
  <div id="recaptcha-container" class="flex justify-center scale-90 mb-3"></div>
  <button id="sendOtpBtn" class="w-full bg-pink-500 text-white py-3 rounded-xl font-bold">
    ‡∏™‡πà‡∏á OTP
  </button>
</div>

<!-- STEP 2 -->
<div id="step2" class="hidden">
  <h3 class="font-bold mb-2">‡∏Å‡∏£‡∏≠‡∏Å OTP</h3>
  <input id="otpInput" type="number" maxlength="6"
    class="w-full p-3 border rounded-xl mb-3 text-center text-2xl tracking-widest">
  <button id="verifyOtpBtn" class="w-full bg-green-500 text-white py-3 rounded-xl font-bold">
    ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
  </button>
  <p id="resendText" class="text-sm text-gray-400 mt-3"></p>
</div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getAuth, onAuthStateChanged,
  GoogleAuthProvider, signInWithPopup,
  RecaptchaVerifier, signInWithPhoneNumber
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
auth.languageCode = 'th';

const provider = new GoogleAuthProvider();

const loginSection = document.getElementById('loginSection');
const phoneModal = document.getElementById('phoneModal');
const sendOtpBtn = document.getElementById('sendOtpBtn');
const verifyOtpBtn = document.getElementById('verifyOtpBtn');
const resendText = document.getElementById('resendText');

let confirmationResult;

// redirect ‡∏´‡∏•‡∏±‡∏á login
onAuthStateChanged(auth, user => {
  if (user) location.href = "index.html";
});

// Google
googleBtn.onclick = () => signInWithPopup(auth, provider);

// Open phone
phoneBtn.onclick = () => {
  phoneModal.classList.remove('hidden');
  if (!window.recaptchaVerifier) {
    window.recaptchaVerifier = new RecaptchaVerifier(auth, 'recaptcha-container');
    recaptchaVerifier.render();
  }
};

// Send OTP + cooldown
sendOtpBtn.onclick = async () => {
  if (sendOtpBtn.disabled) return;

  const num = phoneInput.value;
  if (num.length !== 10) return alert('‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å');

  sendOtpBtn.disabled = true;
  sendOtpBtn.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...';

  const phone = '+66' + num.slice(1);

  try {
    confirmationResult = await signInWithPhoneNumber(auth, phone, recaptchaVerifier);

    step1.classList.add('hidden');
    step2.classList.remove('hidden');
    otpInput.focus();

    let sec = 60;
    resendText.textContent = `‡∏™‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ô ${sec} ‡∏ß‡∏¥`;
    const timer = setInterval(() => {
      sec--;
      resendText.textContent = `‡∏™‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ô ${sec} ‡∏ß‡∏¥`;
      if (sec <= 0) {
        clearInterval(timer);
        resendText.innerHTML = '<button class="text-pink-500">‡∏™‡πà‡∏á OTP ‡πÉ‡∏´‡∏°‡πà</button>';
        resendText.onclick = () => location.reload();
      }
    }, 1000);

  } catch {
    alert('‡∏™‡πà‡∏á OTP ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
    sendOtpBtn.disabled = false;
    sendOtpBtn.innerHTML = '‡∏™‡πà‡∏á OTP';
  }
};

// auto OTP
otpInput.addEventListener('input', () => {
  if (otpInput.value.length === 6) verifyOtpBtn.click();
});

// verify OTP (‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
verifyOtpBtn.onclick = async () => {
  if (verifyOtpBtn.disabled) return;

  verifyOtpBtn.disabled = true;
  verifyOtpBtn.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô...';

  try {
    await confirmationResult.confirm(otpInput.value);
  } catch {
    alert('OTP ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
    verifyOtpBtn.disabled = false;
    verifyOtpBtn.innerHTML = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô';
  }
};
</script>

</body>
</html>
