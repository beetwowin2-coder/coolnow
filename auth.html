<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Account - Cool Now Store</title>

  <!-- UI -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Kanit', sans-serif; }
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  </style>
</head>

<body class="bg-[#FBFBFD] flex flex-col min-h-screen text-gray-800">

<!-- LOADER -->
<div id="loader" class="fixed inset-0 bg-white flex items-center justify-center z-[999]">
  <div class="w-10 h-10 border-4 border-gray-200 border-t-pink-500 rounded-full animate-spin"></div>
</div>

<!-- NAV -->
<nav class="bg-white sticky top-0 py-4 px-6 flex justify-between shadow-sm z-50">
  <span class="font-bold">COOL NOW</span>
</nav>

<!-- MAIN -->
<main class="flex-1 flex items-center justify-center p-4">

<!-- PROFILE -->
<div id="profileSection" class="hidden bg-white p-8 rounded-3xl shadow-xl max-w-md w-full text-center">
  <div id="userPhoto" class="w-24 h-24 mx-auto mb-4 rounded-full overflow-hidden bg-pink-100 flex items-center justify-center text-4xl">üë§</div>
  <h2 id="userName" class="text-xl font-bold"></h2>
  <p id="userEmail" class="text-gray-400 text-sm mb-6"></p>

  <button onclick="location.href='index.html'" class="w-full bg-pink-500 text-white py-3 rounded-xl font-bold mb-3">‡πÑ‡∏õ‡∏ä‡πâ‡∏≠‡∏õ üõçÔ∏è</button>
  <button id="logoutBtn" class="text-sm text-gray-400 hover:text-red-500">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
</div>

<!-- LOGIN -->
<div id="loginSection" class="hidden bg-white p-8 rounded-3xl shadow-xl max-w-md w-full text-center">
  <h2 class="text-2xl font-bold mb-6">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>

  <!-- Google -->
  <button id="googleBtn" class="w-full flex items-center justify-center gap-2 border py-3 rounded-xl mb-3">
    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-5"/>
    Google Sign-In
  </button>

  <!-- Phone -->
  <button id="phoneBtn" class="w-full bg-pink-500 text-white py-3 rounded-xl font-bold">
    üì± ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ + OTP
  </button>
</div>

<!-- PHONE MODAL -->
<div id="phoneModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-[1000]">
  <div class="bg-white p-6 rounded-2xl w-full max-w-sm text-center">

    <div id="step1">
      <h3 class="font-bold mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå</h3>
      <input id="phoneInput" type="tel" placeholder="08xxxxxxxx" maxlength="10"
        class="w-full p-3 border rounded-xl mb-3 text-center"/>
      <div id="recaptcha-container" class="flex justify-center mb-3"></div>
      <button id="sendOtpBtn" class="w-full bg-pink-500 text-white py-3 rounded-xl font-bold">
        ‡∏™‡πà‡∏á OTP
      </button>
    </div>

    <div id="step2" class="hidden">
      <h3 class="font-bold mb-2">‡∏Å‡∏£‡∏≠‡∏Å OTP</h3>
      <input id="otpInput" type="number" maxlength="6"
        class="w-full p-3 border rounded-xl mb-3 text-center text-2xl"/>
      <button id="verifyOtpBtn" class="w-full bg-green-500 text-white py-3 rounded-xl font-bold">
        ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
      </button>
    </div>

  </div>
</div>

</main>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getAuth, onAuthStateChanged,
  GoogleAuthProvider, signInWithPopup,
  signOut, RecaptchaVerifier, signInWithPhoneNumber
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCQGbSSIqRjLblQsY565li1YxXGFQrHxYc",
  authDomain: "coolnow-1d8f4.firebaseapp.com",
  projectId: "coolnow-1d8f4",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
auth.languageCode = 'th';

const provider = new GoogleAuthProvider();

const loader = document.getElementById('loader');
const loginSection = document.getElementById('loginSection');
const profileSection = document.getElementById('profileSection');
const phoneModal = document.getElementById('phoneModal');

let confirmationResult;

// Auth state
onAuthStateChanged(auth, user => {
  loader.style.display = 'none';
  if (user) {
    profileSection.classList.remove('hidden');
    loginSection.classList.add('hidden');
    userName.textContent = user.displayName || user.phoneNumber;
    userEmail.textContent = user.email || '';
    if (user.photoURL) userPhoto.innerHTML = `<img src="${user.photoURL}" class="w-full h-full object-cover"/>`;
  } else {
    loginSection.classList.remove('hidden');
    profileSection.classList.add('hidden');
  }
});

// Google
googleBtn.onclick = () => signInWithPopup(auth, provider);

// Logout
logoutBtn.onclick = () => signOut(auth);

// Phone modal
phoneBtn.onclick = () => {
  phoneModal.classList.remove('hidden');
  if (!window.recaptchaVerifier) {
    window.recaptchaVerifier = new RecaptchaVerifier(auth, 'recaptcha-container');
    recaptchaVerifier.render();
  }
};

// Send OTP (‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡∏£‡∏±‡∏ß)
sendOtpBtn.onclick = async () => {
  sendOtpBtn.disabled = true;
  const num = phoneInput.value;
  if (num.length !== 10) return alert('‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å');

  const phone = '+66' + num.slice(1);
  confirmationResult = await signInWithPhoneNumber(auth, phone, recaptchaVerifier);
  step1.classList.add('hidden');
  step2.classList.remove('hidden');
};

// Verify OTP
verifyOtpBtn.onclick = async () => {
  await confirmationResult.confirm(otpInput.value);
  phoneModal.classList.add('hidden');
};
</script>

</body>
</html>
