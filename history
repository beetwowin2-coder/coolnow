<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ - Cool Now Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; }
        .order-card { animation: fadeIn 0.5s ease-out forwards; opacity: 0; }
        @keyframes fadeIn {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-[#FBFBFD] min-h-screen">

    <div class="max-w-md mx-auto p-4 pb-20">
        <header class="flex items-center justify-between mb-8 pt-4">
            <a href="index.html" class="w-10 h-10 flex items-center justify-center bg-white rounded-2xl shadow-sm text-gray-400 hover:text-pink-500 transition-colors">‚Üê</a>
            <h1 class="text-xl font-bold text-gray-800">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ä‡πâ‡∏≠‡∏õ</h1>
            <div id="userAvatar" class="w-10 h-10 rounded-2xl bg-gray-200 overflow-hidden border-2 border-white shadow-sm">
                </div>
        </header>

        <div id="authRequired" class="hidden flex flex-col items-center justify-center py-20 text-center">
            <div class="w-24 h-24 bg-pink-50 rounded-full flex items-center justify-center mb-6">
                <span class="text-4xl">üîê</span>
            </div>
            <h2 class="text-xl font-bold text-gray-800 mb-2">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</h2>
            <p class="text-gray-400 text-sm mb-8 px-10">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Google ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
            <a href="login.html" class="bg-white border-2 border-pink-100 text-pink-500 px-8 py-3 rounded-2xl font-bold shadow-sm flex items-center gap-2 active:scale-95 transition-all">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" class="w-5">
                ‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Google
            </a>
        </div>

        <div id="historyContainer" class="space-y-4">
            </div>
    </div>

    <div class="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-md border-t border-gray-100 p-4 flex justify-around max-w-md mx-auto">
        <a href="index.html" class="text-gray-400 text-xs flex flex-col items-center gap-1"><span>üè†</span>‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
        <a href="history.html" class="text-pink-500 text-xs flex flex-col items-center gap-1 font-bold"><span>üìú</span>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</a>
    </div>

    <script>
        function initHistory() {
            // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô
            const googleUser = JSON.parse(localStorage.getItem('googleUser'));

            if (!googleUser) {
                document.getElementById('authRequired').classList.remove('hidden');
                document.getElementById('historyContainer').classList.add('hidden');
                return;
            }

            // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
            if (googleUser.photo) {
                document.getElementById('userAvatar').innerHTML = `<img src="${googleUser.photo}" class="w-full h-full object-cover">`;
            }

            // 2. ‡∏î‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (‡πÉ‡∏ä‡πâ email ‡πÄ‡∏õ‡πá‡∏ô Key)
            const allOrders = JSON.parse(localStorage.getItem('orderHistory')) || {};
            const userOrders = allOrders[googleUser.email] || [];

            const container = document.getElementById('historyContainer');

            // 3. ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
            if (userOrders.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-20">
                        <div class="text-6xl mb-4">üõçÔ∏è</div>
                        <p class="text-gray-400 text-sm">‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏•‡∏¢</p>
                        <a href="index.html" class="text-pink-500 font-bold mt-2 inline-block">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ä‡πâ‡∏≠‡∏õ‡∏ä‡∏¥‡πâ‡∏ô‡πÅ‡∏£‡∏Å‡∏Å‡∏±‡∏ô!</a>
                    </div>`;
                return;
            }

            // 4. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤)
            container.innerHTML = userOrders.reverse().map((order, index) => `
                <div class="order-card bg-white p-5 rounded-[2.5rem] shadow-sm border border-gray-50" style="animation-delay: ${index * 0.1}s">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <span class="text-[10px] font-bold text-gray-300 uppercase tracking-widest">ORDER #${order.orderId}</span>
                            <p class="text-[11px] text-gray-400">${order.date || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà'}</p>
                        </div>
                        <div class="px-3 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded-full border border-green-100 uppercase">
                            ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                        </div>
                    </div>

                    <div class="space-y-3 mb-4 bg-gray-50/50 p-3 rounded-2xl">
                        ${order.items.map(item => `
                            <div class="flex justify-between text-xs text-gray-600">
                                <span class="font-light">üì¶ ${item.name}</span>
                                <span class="font-bold">x${item.qty}</span>
                            </div>
                        `).join('')}
                    </div>

                    <div class="pt-2 flex justify-between items-center">
                        <div class="flex flex-col">
                            <span class="text-[10px] text-gray-400 uppercase font-bold">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span>
                            <span class="text-lg font-bold text-gray-800">${order.total} ‡∏ø</span>
                        </div>
                        <button onclick="reOrder('${order.orderId}')" class="text-[11px] font-bold text-pink-500 bg-pink-50 px-4 py-2 rounded-xl active:scale-95 transition-all">
                            ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ã‡πâ‡∏≥ (Optional)
        function reOrder(id) {
            alert('‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #' + id + ' ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Ñ‡πà‡∏∞');
            window.location.href = 'index.html';
        }

        document.addEventListener('DOMContentLoaded', initHistory);
    </script>
</body>
</html>
