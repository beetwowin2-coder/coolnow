<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ - Cool Now Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>body { font-family: 'Kanit', sans-serif; }</style>
</head>
<body class="bg-[#FBFBFD] min-h-screen">

    <div class="max-w-md mx-auto p-4 pb-20">
        <header class="flex items-center justify-between mb-8 pt-4">
            <a href="index.html" class="w-10 h-10 flex items-center justify-center bg-white rounded-2xl shadow-sm text-gray-400">‚Üê</a>
            <h1 class="text-xl font-bold text-gray-800">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ä‡πâ‡∏≠‡∏õ</h1>
            <div id="userAvatar" class="w-10 h-10 rounded-2xl bg-gray-200 overflow-hidden border-2 border-white shadow-sm">
                </div>
        </header>

        <div id="authRequired" class="hidden flex flex-col items-center justify-center py-20 text-center">
            <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-6">
                <span class="text-4xl">üîí</span>
            </div>
            <h2 class="text-xl font-bold text-gray-800 mb-2">‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</h2>
            <p class="text-gray-400 text-sm mb-8 px-10">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Google ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
            <a href="login.html" class="bg-white border border-gray-200 text-gray-700 px-8 py-3 rounded-2xl font-bold shadow-sm flex items-center gap-2">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" class="w-5">
                ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô
            </a>
        </div>

        <div id="historyContainer" class="space-y-4">
            </div>
    </div>

    <script>
        function initHistory() {
            // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• User ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¥‡∏ô Google (‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡πÉ‡∏ô localStorage/sessionStorage)
            const googleUser = JSON.parse(localStorage.getItem('googleUser'));

            if (!googleUser) {
                document.getElementById('authRequired').classList.remove('hidden');
                document.getElementById('historyContainer').classList.add('hidden');
                return;
            }

            // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå Google
            if (googleUser.photo) {
                document.getElementById('userAvatar').innerHTML = `<img src="${googleUser.photo}" class="w-full h-full object-cover">`;
            }

            // 2. ‡∏î‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö Email)
            const allOrders = JSON.parse(localStorage.getItem('orderHistory')) || {};
            const userOrders = allOrders[googleUser.email] || [];

            const container = document.getElementById('historyContainer');

            if (userOrders.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-20">
                        <p class="text-gray-400 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞</p>
                        <a href="index.html" class="text-pink-500 font-bold mt-2 inline-block">‡πÑ‡∏õ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ä‡πâ‡∏≠‡∏õ‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢!</a>
                    </div>`;
                return;
            }

            // 3. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (‡πÇ‡∏ä‡∏ß‡πå‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏•‡πá‡∏Å‡πÜ)
            container.innerHTML = userOrders.map(order => `
                <div class="bg-white p-5 rounded-[2.5rem] shadow-sm border border-gray-50">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <span class="text-[10px] font-bold text-gray-300 uppercase tracking-widest">ORDER ${order.orderId}</span>
                            <p class="text-xs text-gray-400">${order.date}</p>
                        </div>
                        <div class="px-3 py-1 bg-green-50 text-green-600 text-[10px] font-bold rounded-full border border-green-100">
                            SUCCESS
                        </div>
                    </div>

                    <div class="space-y-2 mb-4">
                        ${order.items.map(item => `
                            <div class="flex justify-between text-sm text-gray-600">
                                <span class="font-light">‚óã ${item.name}</span>
                                <span class="font-bold">x${item.qty}</span>
                            </div>
                        `).join('')}
                    </div>

                    <div class="pt-4 border-t border-gray-50 flex justify-between items-center">
                        <span class="text-xs text-gray-400">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span>
                        <span class="text-lg font-bold text-gray-800">${order.total} ‡∏ø</span>
                    </div>
                </div>
            `).join('');
        }

        document.addEventListener('DOMContentLoaded', initHistory);
    </script>
</body>
</html>
