<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Cool Now</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; }
        .active-push:active { transform: scale(0.98); }
        /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏ï‡∏≠‡∏ô‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á */
        #uploadZone.drag-over { 
            border-color: #ec4899; 
            background-color: #fdf2f8;
            transform: scale(1.02);
        }
        .qr-container { filter: drop-shadow(0 10px 15px rgba(0,0,0,0.1)); }
        textarea::placeholder { color: #cbd5e1; font-weight: 300; }
    </style>
</head>
<body class="bg-[#FBFBFD] text-gray-800 pb-20">

    <nav class="p-6">
        <a href="index.html" class="text-gray-400 hover:text-gray-600 flex items-center gap-2 transition group">
            <span class="group-hover:-translate-x-1 transition-transform">‚Üê</span> ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
        </a>
    </nav>

    <main class="container mx-auto max-w-2xl px-4">
        <h1 class="text-3xl font-bold mb-8 text-center md:text-left">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h1>

        <div id="checkoutItems" class="space-y-4 mb-8">
            </div>

        <section class="bg-white rounded-[2rem] p-8 shadow-sm border border-gray-100 mb-6">
            <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                <span class="text-xl">üìç</span> ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
            </h2>
            <textarea id="address" 
                      placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå ‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." 
                      class="w-full h-32 bg-gray-50 rounded-2xl p-4 focus:outline-none border border-transparent focus:border-pink-200 focus:bg-white transition-all resize-none"></textarea>
        </section>

        <section class="bg-white rounded-[2.5rem] p-8 shadow-sm border border-gray-100 mb-8">
            <h2 class="text-lg font-bold mb-6 flex items-center gap-2">
                <span class="text-xl">üí∞</span> ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
            </h2>
            
            <div class="flex flex-col items-center mb-8">
                <div class="bg-white p-6 rounded-3xl border-2 border-blue-500 qr-container text-center max-w-[280px] w-full">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/c/c5/PromptPay-logo.png" class="h-6 mx-auto mb-4" alt="PromptPay">
                    <img id="promptpayQR" src="" class="w-48 h-48 mx-auto rounded-lg shadow-sm" alt="QR Code">
                    <p class="mt-4 font-bold text-blue-900 text-lg">‡∏ì‡∏±‡∏ê‡∏ë‡∏¥‡∏ä‡∏≤ ‡∏™‡∏±‡∏à‡∏à‡∏∞‡∏ß‡∏±‡∏í‡∏ô‡∏∞</p>
                    <p class="text-gray-500 text-sm tracking-widest">186-990-026-9561</p>
                </div>

                <div class="mt-6 w-full max-w-[280px] bg-blue-50 border border-blue-100 rounded-2xl p-4 flex items-center gap-4">
                    <div class="bg-white p-2 rounded-xl shadow-sm">
                        <img src="https://www.bbl.co.th/images/logo.png" class="w-6 h-6 object-contain" alt="BBL">
                    </div>
                    <div>
                        <p class="text-[10px] font-bold text-blue-400 uppercase tracking-tighter leading-none mb-1">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û (BBL)</p>
                        <p class="text-blue-900 font-bold leading-none">930-0-272847</p>
                    </div>
                </div>
            </div>
            
            <div class="space-y-4">
                <p class="text-sm font-bold text-gray-700 ml-1">‡πÅ‡∏ô‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</p>
                <div id="uploadZone" 
                     class="relative group cursor-pointer border-2 border-dashed border-pink-200 bg-pink-50/30 rounded-[2rem] p-8 transition-all hover:border-pink-400 hover:bg-pink-50 flex flex-col items-center justify-center min-h-[220px]">
                    
                    <input type="file" id="slipInput" accept="image/*" class="hidden" onchange="previewSlip(this)">
                    
                    <div id="uploadPrompt" class="text-center">
                        <div class="w-16 h-16 bg-white rounded-2xl shadow-sm flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform text-3xl">üì∏</div>
                        <p class="font-bold text-pink-600 uppercase tracking-wide">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ</p>
                        <p class="text-xs text-pink-400 mt-1">‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                    </div>

                    <div id="previewContainer" class="hidden w-full flex flex-col items-center">
                        <img id="slipPreview" src="#" class="max-h-64 rounded-xl shadow-md border-2 border-white mb-3">
                        <button type="button" onclick="resetUpload(event)" class="text-xs font-bold text-pink-500 hover:underline">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</button>
                    </div>
                </div>
            </div>
        </section>

        <div class="bg-white rounded-[2.5rem] p-8 shadow-xl shadow-pink-100/30 border border-pink-50">
            <div class="space-y-3 mb-6" id="summaryArea">
                </div>
            <button onclick="confirmOrder()" class="w-full bg-pink-500 text-white py-5 rounded-2xl font-bold text-lg shadow-lg shadow-pink-200 hover:bg-pink-600 transition active-push flex items-center justify-center gap-2">
                ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ üöÄ
            </button>
        </div>
    </main>

    <script>
        let cart = JSON.parse(localStorage.getItem('coolNowCart')) || [];
        let finalTotal = 0;

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Render ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°
        function renderCheckout() {
            const itemsContainer = document.getElementById('checkoutItems');
            const summaryArea = document.getElementById('summaryArea');
            const qrImg = document.getElementById('promptpayQR');
            
            if (cart.length === 0) {
                itemsContainer.innerHTML = `<div class="bg-white p-12 rounded-[2rem] text-center text-gray-400 border border-dashed border-gray-200 font-light italic">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</div>`;
                summaryArea.innerHTML = `<p class="text-center text-gray-400 font-bold">‡∏¢‡∏≠‡∏î‡πÄ‡∏õ‡πá‡∏ô 0 ‡∏ö‡∏≤‡∏ó</p>`;
                return;
            }

            let subtotal = 0;
            let totalItems = 0;
            let html = '';

            cart.forEach((item, index) => {
                subtotal += item.price * item.qty;
                totalItems += item.qty;
                
                html += `
                    <div class="bg-white p-4 rounded-[1.8rem] border border-gray-100 flex items-center gap-4 shadow-sm hover:shadow-md transition-shadow">
                        <img src="${item.img}" class="w-20 h-20 object-contain bg-gray-50 rounded-2xl p-2" loading="lazy">
                        <div class="flex-1">
                            <h3 class="font-bold text-sm leading-tight text-gray-800">${item.name}</h3>
                            <p class="text-pink-500 font-bold mt-1">${item.price.toLocaleString()} ‡∏ø</p>
                        </div>
                        <div class="flex items-center gap-3 bg-gray-50 p-2 rounded-xl border border-gray-100">
                            <button onclick="updateQty(${index}, -1)" class="w-8 h-8 bg-white rounded-lg shadow-sm flex items-center justify-center font-bold active-push text-gray-500 hover:text-pink-500">-</button>
                            <span class="font-bold min-w-[20px] text-center text-sm">${item.qty}</span>
                            <button onclick="updateQty(${index}, 1)" class="w-8 h-8 bg-white rounded-lg shadow-sm flex items-center justify-center font-bold active-push text-gray-500 hover:text-pink-500">+</button>
                        </div>
                    </div>
                `;
            });

            itemsContainer.innerHTML = html;

            const shippingFee = (totalItems >= 2) ? 0 : 40;
            finalTotal = subtotal + shippingFee;

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï QR Code ‡∏ï‡∏≤‡∏°‡∏¢‡∏≠‡∏î‡∏à‡∏£‡∏¥‡∏á (‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå‡πÅ‡∏ö‡∏ö‡πÉ‡∏™‡πà‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô)
            qrImg.src = `https://promptpay.io/1869900269561/${finalTotal}.png`;

            summaryArea.innerHTML = `
                <div class="flex justify-between text-gray-500 font-medium">
                    <span>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡∏ß‡∏° (${totalItems} ‡∏ä‡∏¥‡πâ‡∏ô)</span>
                    <span>${subtotal.toLocaleString()} ‡∏ø</span>
                </div>
                <div class="flex justify-between text-gray-500 font-medium">
                    <span>‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</span>
                    <span class="${shippingFee === 0 ? 'text-green-500 font-bold' : ''}">
                        ${shippingFee === 0 ? '‡∏ü‡∏£‡∏µ‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á ‚ú®' : '40 ‡∏ø'}
                    </span>
                </div>
                <div class="flex justify-between items-end pt-4 border-t border-dashed border-gray-200 mt-2">
                    <span class="text-xl font-bold text-gray-800">‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞</span>
                    <span class="text-3xl font-bold text-pink-500">${finalTotal.toLocaleString()} ‡∏ø</span>
                </div>
            `;
        }

        // ‡∏õ‡∏£‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        function updateQty(index, amount) {
            cart[index].qty += amount;
            if (cart[index].qty <= 0) {
                if(confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                    cart.splice(index, 1);
                } else {
                    cart[index].qty = 1;
                }
            }
            localStorage.setItem('coolNowCart', JSON.stringify(cart));
            renderCheckout();
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏™‡∏•‡∏¥‡∏õ
        function previewSlip(input) {
            const prompt = document.getElementById('uploadPrompt');
            const container = document.getElementById('previewContainer');
            const preview = document.getElementById('slipPreview');
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    prompt.classList.add('hidden');
                    container.classList.remove('hidden');
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
        function resetUpload(event) {
            event.stopPropagation();
            document.getElementById('slipInput').value = "";
            document.getElementById('uploadPrompt').classList.remove('hidden');
            document.getElementById('previewContainer').classList.add('hidden');
        }

        // ‡∏£‡∏∞‡∏ö‡∏ö Drag & Drop
        const uploadZone = document.getElementById('uploadZone');

        uploadZone.onclick = () => document.getElementById('slipInput').click();

        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('drag-over');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('drag-over');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                document.getElementById('slipInput').files = files;
                previewSlip(document.getElementById('slipInput'));
            }
        });

        // ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
        function confirmOrder() {
            const address = document.getElementById('address').value;
            const slip = document.getElementById('slipInput').files[0];

            if (cart.length === 0) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠');
            if (!address.trim()) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
            if (!slip) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô');

            // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Success (‡∏à‡∏≥‡∏•‡∏≠‡∏á)
            const orderSummary = {
                customerName: address.split('\n')[0].split(',')[0].trim() || '‡∏Ñ‡∏∏‡∏ì‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤',
                totalAmount: finalTotal.toLocaleString() + ' ‡∏ø'
            };
            sessionStorage.setItem('lastOrder', JSON.stringify(orderSummary));

            // ‡πÅ‡∏™‡∏î‡∏á Loading ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡∏à‡∏£‡∏¥‡∏á
            const btn = event.target;
            btn.innerHTML = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...";
            btn.disabled = true;

            setTimeout(() => {
                alert('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß');
                localStorage.removeItem('coolNowCart');
                window.location.href = 'order-success.html'; 
            }, 1500);
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
        document.addEventListener('DOMContentLoaded', renderCheckout);
    </script>
</body>
</html>
