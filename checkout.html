<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Cool Now Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; }
        .form-input:focus { border-color: #ec4899; box-shadow: 0 0 0 4px rgba(236, 72, 153, 0.1); }
        .spinner { border: 3px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top: 3px solid #fff; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô */
        button:disabled { cursor: not-allowed; filter: grayscale(1); opacity: 0.6; }
    </style>
</head>
<body class="bg-[#FBFBFD] text-gray-800">

    <div id="emailAlert" class="hidden bg-yellow-50 border-b border-yellow-100 p-4 sticky top-0 z-[60]">
        <div class="container mx-auto flex items-center gap-3">
            <span class="text-xl">üìß</span>
            <div>
                <p class="text-sm font-bold text-yellow-800">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                <p class="text-xs text-yellow-700">‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÉ‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‡πÇ‡∏õ‡∏£‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</p>
            </div>
        </div>
    </div>

    <nav class="bg-white/80 backdrop-blur-md py-4 px-6 shadow-sm sticky top-0 z-50">
        <div class="container mx-auto flex items-center justify-between">
            <a href="products.html" class="flex items-center gap-2 text-gray-400 hover:text-pink-500 transition group">
                <span class="group-hover:-translate-x-1 transition-transform">‚¨ÖÔ∏è</span> 
                <span class="text-sm font-medium">Continue Shopping</span>
            </a>
            <img src="images/logo.png" alt="Logo" class="h-8 md:h-9">
            <div id="userBadge" class="flex items-center gap-2 bg-gray-50 px-3 py-1.5 rounded-full border border-gray-100">
                <div id="userThumb" class="w-6 h-6 rounded-full overflow-hidden bg-gray-200 flex items-center justify-center text-[10px]">üë§</div>
                <span id="userShortName" class="text-[10px] font-bold text-gray-500 uppercase tracking-wider">Account</span>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 max-w-6xl mb-20 mt-6">
        <div class="flex flex-col lg:flex-row gap-8">
            <div class="lg:w-[60%] space-y-6">
                <div class="bg-white p-6 md:p-10 rounded-[2.5rem] shadow-sm border border-gray-100">
                    <h2 class="text-xl font-bold mb-8 flex items-center gap-3">
                        <span class="bg-pink-50 p-2 rounded-xl text-lg">üìç</span> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="md:col-span-2">
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-2 ml-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                            <input type="text" id="custName" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö" class="w-full bg-gray-50 border border-gray-100 rounded-2xl px-5 py-4 focus:outline-none transition form-input">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-2 ml-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                            <input type="tel" id="custPhone" maxlength="10" placeholder="08x-xxx-xxxx" class="w-full bg-gray-50 border border-gray-100 rounded-2xl px-5 py-4 focus:outline-none transition form-input">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-2 ml-1">‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß)</label>
                            <input type="email" id="custEmail" readonly class="w-full bg-gray-100 border border-gray-100 rounded-2xl px-5 py-4 text-gray-500 cursor-not-allowed">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-xs font-bold text-gray-400 uppercase mb-2 ml-1">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</label>
                            <textarea id="custAddress" rows="3" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà, ‡∏ñ‡∏ô‡∏ô, ‡πÅ‡∏Ç‡∏ß‡∏á/‡∏ï‡∏≥‡∏ö‡∏•, ‡πÄ‡∏Ç‡∏ï/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠, ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î, ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå" class="w-full bg-gray-50 border border-gray-100 rounded-2xl px-5 py-4 focus:outline-none transition form-input"></textarea>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 md:p-10 rounded-[2.5rem] shadow-sm border border-gray-100">
                    <h2 class="text-xl font-bold mb-8 flex items-center gap-3">
                        <span class="bg-blue-50 p-2 rounded-xl text-lg">üí≥</span> ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                    </h2>
                    <div class="relative border-2 border-pink-500 bg-white p-6 rounded-[1.8rem] flex flex-col md:flex-row items-center gap-6 shadow-sm mb-6">
                        <img id="paymentQR" src="" class="w-32 h-32 border rounded-xl" alt="QR">
                        <div class="text-center md:text-left">
                            <p class="font-bold text-gray-800 text-lg">Thai QR Payment</p>
                            <p class="text-sm text-pink-500 font-bold">‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
                            <p class="text-xs text-gray-500 mt-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: ‡∏ì‡∏±‡∏ê‡∏ë‡∏¥‡∏ä‡∏≤ ‡∏™‡∏±‡∏à‡∏à‡∏∞‡∏ß‡∏±‡∏í‡∏ô‡∏∞</p>
                        </div>
                    </div>
                    <div class="text-center">
                        <input type="file" id="slipUpload" accept="image/*" class="hidden">
                        <div id="slipPreviewContainer" class="hidden mb-4"><img id="slipPreview" class="max-w-[200px] mx-auto rounded-xl shadow-md"></div>
                        <label for="slipUpload" id="uploadLabel" class="cursor-pointer bg-gray-100 px-8 py-4 rounded-2xl text-sm font-bold inline-block">üì∏ ‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô</label>
                    </div>
                </div>
            </div>

            <div class="lg:w-[40%]">
                <div class="bg-white p-6 md:p-8 rounded-[2.5rem] shadow-sm border border-gray-100 sticky top-28">
                    <h2 class="text-xl font-bold mb-6">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h2>
                    <div id="checkout-items-list" class="space-y-4 mb-8"></div>
                    <div class="space-y-3 pt-6 border-t">
                        <div class="flex justify-between text-gray-400"><span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</span><span id="subtotal">0 ‡∏ø</span></div>
                        <div class="flex justify-between text-gray-400"><span>‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</span><span id="shipping">‡∏ü‡∏£‡∏µ</span></div>
                        <div class="flex justify-between text-2xl font-bold pt-4"><span>‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span><span id="total" class="text-pink-500">0 ‡∏ø</span></div>
                    </div>
                    <button id="submitBtn" onclick="confirmOrder()" class="w-full bg-pink-500 text-white py-5 rounded-2xl font-bold text-lg mt-8 shadow-lg shadow-pink-100">
                        ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ üöÄ
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCQGbSSIqRjLblQsY565li1YxXGFQrHxYc",
            authDomain: "coolnow-1d8f4.firebaseapp.com",
            projectId: "coolnow-1d8f4",
            storageBucket: "coolnow-1d8f4.firebasestorage.app",
            messagingSenderId: "857055916856",
            appId: "1:857055916856:web:c32673482de318e04a07cd"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('custEmail').value = user.email;
                document.getElementById('custName').value = user.displayName || "";
                document.getElementById('userShortName').innerText = user.displayName ? user.displayName.split(' ')[0] : "Account";
                if(user.photoURL) document.getElementById('userThumb').innerHTML = `<img src="${user.photoURL}" class="w-full h-full object-cover">`;

                // --- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏• ---
                const emailAlert = document.getElementById('emailAlert');
                const submitBtn = document.getElementById('submitBtn');

                // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: Google Login ‡∏à‡∏∞ verified ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏™‡∏°‡∏≠
                if (user.emailVerified) {
                    emailAlert.classList.add('hidden');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = `‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ üöÄ`;
                } else {
                    emailAlert.classList.remove('hidden');
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = `‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠`;
                }
            } else {
                window.location.href = 'auth.html';
            }
        });
    </script>

    <script>
        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡∏∞ QR Code
        function loadOrderData() {
            const cart = JSON.parse(localStorage.getItem('coolNowCart')) || [];
            if (cart.length === 0) { window.location.href = 'products.html'; return; }

            const listContainer = document.getElementById('checkout-items-list');
            let subtotal = 0;
            listContainer.innerHTML = '';

            cart.forEach(item => {
                subtotal += (item.price * item.qty);
                listContainer.innerHTML += `
                    <div class="flex justify-between items-center bg-gray-50 p-3 rounded-2xl">
                        <div class="flex items-center gap-3">
                            <img src="${item.img}" class="w-10 h-10 object-contain">
                            <div>
                                <p class="text-xs font-bold">${item.name}</p>
                                <p class="text-[10px] text-gray-400">${item.qty} x ${item.price}‡∏ø</p>
                            </div>
                        </div>
                        <p class="text-sm font-bold">${item.price * item.qty}‡∏ø</p>
                    </div>`;
            });

            document.getElementById('subtotal').innerText = subtotal + ' ‡∏ø';
            document.getElementById('total').innerText = subtotal + ' ‡∏ø';
            document.getElementById('paymentQR').src = `https://promptpay.io/1869900269561/${subtotal}.png`;
        }

        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏•‡∏¥‡∏õ
        document.getElementById('slipUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    document.getElementById('slipPreview').src = ev.target.result;
                    document.getElementById('slipPreviewContainer').classList.remove('hidden');
                }
                reader.readAsDataURL(file);
            }
        });

        function confirmOrder() {
            const slip = document.getElementById('slipUpload').files[0];
            if(!document.getElementById('custAddress').value || !slip) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }
            alert('‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏±‡∏ö');
            localStorage.removeItem('coolNowCart');
            window.location.href = 'index.html';
        }

        document.addEventListener('DOMContentLoaded', loadOrderData);
    </script>
</body>
</html>